<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Pato Movible</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: lightblue;
        }

        /* El pato en pantalla */
        #duck {
            width: 60px;
            height: 60px;
            background: yellow;
            position: absolute;
            top: 200px;
            left: 200px;
            border-radius: 15px;
            border: 3px solid orange;
        }
    </style>
</head>

<body>

    <!-- El pato visible -->
    <div id="duck"></div>

    <script src="../Scripts/Objs/gameItem.js"></script>
    <script src="../Scripts/Objs/Duck.js"></script>
    <script>
        // Crear pato
        const duckElement = document.getElementById("duck");
        const pato = new Duck(duckElement);

        // Rastrear teclas presionadas
        const pressedKeys = new Set();

        window.addEventListener("keydown", (event) => {
            pressedKeys.add(event.key);

            // Dash con Space
            if (event.key === " ") {
                event.preventDefault();
                pato.dash(pressedKeys);  // Pasa pressedKeys
            }

            // Ejemplo: Presiona 'P' para animación de recoger (placeholder)
            if (event.key === "p") {
                pato.setAnimationState("picking");
            }
        });

        window.addEventListener("keyup", (event) => {
            pressedKeys.delete(event.key);
        });

        // Bucle de juego para movimiento continuo
        function gameLoop() {
            pato.update(); // Actualiza estado (dash, etc.)

            if (pato._state === 1) { // STUNNED
                requestAnimationFrame(gameLoop);
                return;
            }

            let dx = 0;
            let dy = 0;
            let moved = false;
            const speed = pato._speed;  // Normal speed for keys

            if (pato.isDashing) {
                // Movimiento automático durante dash
                pato.x += pato.dashDx;
                pato.y += pato.dashDy;
                moved = true;
            } else {
                // Movimiento normal con teclas
                if (pressedKeys.has("ArrowUp")) {
                    dy -= speed;
                    pato.direction = "up";
                    moved = true;
                }
                if (pressedKeys.has("ArrowDown")) {
                    dy += speed;
                    pato.direction = "down";
                    moved = true;
                }
                if (pressedKeys.has("ArrowLeft")) {
                    dx -= speed;
                    pato.direction = "left";
                    moved = true;
                }
                if (pressedKeys.has("ArrowRight")) {
                    dx += speed;
                    pato.direction = "right";
                    moved = true;
                }

                pato.x += dx;
                pato.y += dy;
            }

            pato.isMoving = moved; // Flag para idle/walking

            if (moved) {
                pato.updateAnimation();
            }

            pato.render();

            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>

</body>

</html>